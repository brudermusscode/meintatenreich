$(function(){let e=$("body");$(document).on("click",'[data-action="open-login"], [data-action="open-signup"]',function(){var a,t,n=$(this),o=n.data("json");o=o[0].open,"login"===o?(a="open-login",t="/ajax/popups/sign/in"):(a="open-signup",t="/ajax/popups/sign/up"),addOverlay(e);var i=e.find("page-overlay");addLoader(i,"floating");var r=$("loader").parent();$.ajax({type:"TEXT",method:"POST",url:t,data:{action:a},success:function(e){r.remove(),i.append(e)}})}),$(document).on("click",'[data-action="signup"]',function(){let a=$('[data-form="signup"]'),t=a.find('input[name="mail"]').val(),n=$("login-container"),o=checkFormInputEmpty(a),i=dynamicHost+"/ajax/functions/sign/up";if(!1===o)showDialer("Bitte fülle alle Felder aus!");else if(validateEmail(t)){addOverlay(n,dark=!0);let a=e.find("page-overlay"),o=n.find("page-overlay");o.find("close-overlay").remove(),addLoader(o,"floating");let r=$('[data-form="signup"]').serialize();$.ajax({data:r,url:i,method:"POST",type:"TEXT",success:function(e){let i;switch(grecaptcha.reset(),e){case"0":i="Ein unbekannter Fehler ist aufgetreten.";break;case"1":i='Bitte akzeptiere die <a href="/intern/index#dsg-general-cookies" target="_blank">Cookie-Bedingungen</a>, um fortzufahren';break;case"2":i='Bitte akzeptiere unsere <a href="/intern/index" target="_blank">AGB</a> und <a href="#" target="_blank">Datenschutzerklärung</a>!';break;case"3":i="Die gewählten Passwörter stimmen nicht überein";break;case"4":i="Bitte wähle ein Passwort zwischen 8 und 32 Zeichen";break;case"5":i="Der Captcha-Code scheint falsch zu sein, versuche es erneut";break;case"6":i="Deine E-Mail hat ein falsches Format. Bitte nutze name@host.endung!";break;case"7":i="Diese E-Mail Adresse wird bereits verwendet";break;default:console.log($.parseJSON(e)),i='Du hast Dich erfolgreich registriert. Eine E-Mail zur Bestätigung wurde an <span style="color:#F1D394;"><strong>'+t+"</strong></span> gesendet!",n.remove(),addTextDialogue(a,"Erfolg!"),setTimeout(function(){window.location.reload()},2e3)}showDialer(i),o.css("opacity","0"),setTimeout(function(){o.remove()},200)}})}else showDialer("Ihre E-Mail hat ein falsches Format. Bitte nutze name@host.endung")}).on("submit",'form[data-form="login"]',function(a){let t,n,o,i,r,s,l;return a.preventDefault(),o=new FormData(this),i=$(this).attr("method"),s=dynamicHost+"/ajax/functions/sign/in",t=$("login-container"),""==o.get("mail")||""==o.get("password")?(showDialer("Alle Felder müssen ausgefüllt sein"),!1):(addOverlay(t,dark=!0),l=e.find("page-overlay"),n=e.find("page-overlay login-container page-overlay"),n.find("close-overlay").remove(),addLoader(n,"floating"),$.ajax({data:o,url:s,method:i,contentType:!1,processData:!1,type:"JSON",success:function(e){r=e.message,e.status&&(t.remove(),addTextDialogue(l,"Hallo<br>"+o.get("mail")),setTimeout(function(){window.location.reload()},1200)),showDialer(r),n.css("opacity","0"),setTimeout(function(){n.remove()},200)},error:function(e){console.error(e)}}),!1)}).on("click",'[data-action="forgot-password"]',function(){let a=e.find("page-overlay"),t=a.find("login-container"),n="forgot-password";t.fadeOut(100),addLoader(a,"floating");var o=a.find("loader").parent();let i=dynamicHost+"/ajax/popups/forgot-password";setTimeout(function(){$.ajax({url:i,data:{action:n},method:"POST",type:"HTML",success:function(e){switch(e){case"0":case"1":console.log("someone likes to play");break;default:o.remove(),a.append(e),form=$('[data-form="fgp"]').find('input[name="mail"]').focus()}}})},100)}).on("click",'[data-action="new-password"]',function(){var a,t=$('[data-form="fgp"]'),n=$.trim(t.find('input[name="mail"]').val()),o="forgot-password",i=t.serialize()+"&action="+o;if(n<1)showDialer("Bitte fülle alle Felder aus!");else{t.find('input[name="mail"]').blur();var r=e.find("page-overlay"),s=r.find("wide-container");addOverlay(s,dark=!0);s.find("close-overlay").remove();var l=s.find("page-overlay");addLoader(l,"floating");let n=dynamicHost+"/ajax/functions/sign/forgot-password";$.ajax({url:n,data:i,method:"POST",type:"TEXT",success:function(e){switch(console.log(e),l.removeAttr("style"),setTimeout(function(){l.remove()},400),e){case"":case"0":case"2":a="Oh nein! Ein Fehler!";break;case"1":a="Deine E-Mail hat ein falsches Format. Bitte Nutze name@host.endung";break;default:a="Falls die angegebene E-Mail Adresse existiert, haben wir eine Mail zum Zurücksetzen des Passworts gesendet",r.removeAttr("style"),setTimeout(function(){r.remove()},400)}showDialer(a)}})}}).on("submit",'[data-form="fgp"]',function(e){var a=$(this).parents().eq(3).find("button");return a.click(),!1}).on("click",'[data-action="request-new-password"]',function(){var a,t=$('[data-form="new-password"]'),n=checkFormInputEmpty(t),o="forgot-password-2";if(!1===n)showDialer("Bitte fülle alle Felder aus!");else{var i=t.serialize()+"&action="+o;addOverlay(e);var r=e.find("page-overlay");r.find("close-overlay").remove();addLoader(r,"floating");var s=r.find("loader").parent(),l=["","0","1","5","2","3","4"];let n=dynamicHost+"/ajax/functions/sign/forgot-password";$.ajax({url:n,data:i,method:"POST",type:"TEXT",success:function(e){switch(console.log($.parseJSON(e)),s.remove(),$.inArray(e,l)?(r.removeAttr("style"),setTimeout(function(){r.remove()},400)):(addTextDialogue(r,"Passwort geändert!"),setTimeout(function(){window.location.replace("/")},1200)),e){case"":case"0":case"5":a="Ein unbekannter Fehler ist aufgetreten.";break;case"1":a="Du hast dein Passwort über diesen Key bereits geändert";break;case"2":a="Deine eingegebenen Passwörter stimmen nicht überein";break;case"3":a="Dein Passwort sollte sicherheitshalber min. 8 Zeichen enthalten";break;case"4":a="Dein Passwort enthält unzulässige Zeichen. Erlaubt sind a-z, A-Z, 0-9, =.,_-+*#~?!&%$§!";break;default:a="Erfolgreich geändert!",setTimeout(function(){window.location.replace("/")},600)}showDialer(a)}})}}).on("click",'[data-action="signout"]',function(){let a,t="logout",n=dynamicHost+"/ajax/functions/sign/out";addOverlay(e);let o=e.find("page-overlay");addLoader(o,"floating");let i=o.find("loader").parent();$.ajax({url:n,data:{action:t},method:"POST",type:"TEXT",success:function(e){i.remove(),"0"===e?(a="Erfolgreich ausgeloggt!",addTextDialogue(o,"Ausgeloggt"),setTimeout(function(){window.location.replace("/")},600)):(a="Ein unbekannter Fehler ist aufgetreten!",o.removeAttr("style"),setTimeout(function(){o.remove()},400)),showDialer(a)}})})});