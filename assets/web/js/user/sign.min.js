$(function(){let e=$("body");$(document).on("click",'[data-action="open-login"], [data-action="open-signup"]',function(){var a,o,t=$(this),n=t.data("json");n=n[0].open,"login"===n?(a="open-login",o="/ajax/popups/sign/in"):(a="open-signup",o="/ajax/popups/sign/up"),addOverlay(e);var i=e.find("page-overlay");addLoader(i,"floating");var r=$("loader").parent();$.ajax({type:"TEXT",method:"POST",url:o,data:{action:a},success:function(e){r.remove(),i.append(e)}})}),$(document).on("click",'[data-action="signup"]',function(){let a,o,t,n,i,r,s;a=$('[data-form="signup"]'),o=a.find('input[name="mail"]').val(),t=$("login-container"),n=dynamicHost+"/ajax/functions/sign/up",addOverlay(t,dark=!0),r=e.find("page-overlay"),s=t.find("page-overlay"),s.find("close-overlay").remove(),addLoader(s,"floating"),i=$('[data-form="signup"]').serialize(),$.ajax({data:i,url:n,method:"POST",type:"JSON",success:function(e){console.log(e),e.status?(t.remove(),addTextDialogue(r,"Erfolg!"),setTimeout(function(){window.location.reload()},1e3)):(grecaptcha.reset(),s.css("opacity","0"),setTimeout(function(){s.remove()},200)),showDialer(e.message)},error:function(e){console.error(e)}})}).on("submit",'form[data-form="login"]',function(a){let o,t,n,i,r,s,l;return a.preventDefault(),n=new FormData(this),i=$(this).attr("method"),s=dynamicHost+"/ajax/functions/sign/in",o=$("login-container"),""==n.get("mail")||""==n.get("password")?(showDialer("Alle Felder müssen ausgefüllt sein"),!1):(addOverlay(o,dark=!0),l=e.find("page-overlay"),t=e.find("page-overlay login-container page-overlay"),t.find("close-overlay").remove(),addLoader(t,"floating"),$.ajax({data:n,url:s,method:i,contentType:!1,processData:!1,type:"JSON",success:function(e){r=e.message,e.status&&(o.remove(),addTextDialogue(l,"Hallo<br>"+n.get("mail")),setTimeout(function(){window.location.reload()},1200)),showDialer(r),t.css("opacity","0"),setTimeout(function(){t.remove()},200)},error:function(e){console.error(e)}}),!1)}).on("click",'[data-action="forgot-password"]',function(){let a=e.find("page-overlay"),o=a.find("login-container"),t="forgot-password";o.fadeOut(100),addLoader(a,"floating");var n=a.find("loader").parent();let i=dynamicHost+"/ajax/popups/forgot-password";setTimeout(function(){$.ajax({url:i,data:{action:t},method:"POST",type:"HTML",success:function(e){switch(e){case"0":case"1":console.log("someone likes to play");break;default:n.remove(),a.append(e),form=$('[data-form="fgp"]').find('input[name="mail"]').focus()}}})},100)}).on("click",'[data-action="new-password"]',function(){var a,o=$('[data-form="fgp"]'),t=$.trim(o.find('input[name="mail"]').val()),n="forgot-password",i=o.serialize()+"&action="+n;if(t<1)showDialer("Bitte fülle alle Felder aus!");else{o.find('input[name="mail"]').blur();var r=e.find("page-overlay"),s=r.find("wide-container");addOverlay(s,dark=!0);s.find("close-overlay").remove();var l=s.find("page-overlay");addLoader(l,"floating");let t=dynamicHost+"/ajax/functions/sign/forgot-password";$.ajax({url:t,data:i,method:"POST",type:"TEXT",success:function(e){switch(console.log(e),l.removeAttr("style"),setTimeout(function(){l.remove()},400),e){case"":case"0":case"2":a="Oh nein! Ein Fehler!";break;case"1":a="Deine E-Mail hat ein falsches Format. Bitte Nutze name@host.endung";break;default:a="Falls die angegebene E-Mail Adresse existiert, haben wir eine Mail zum Zurücksetzen des Passworts gesendet",r.removeAttr("style"),setTimeout(function(){r.remove()},400)}showDialer(a)}})}}).on("submit",'[data-form="fgp"]',function(e){var a=$(this).parents().eq(3).find("button");return a.click(),!1}).on("click",'[data-action="request-new-password"]',function(){var a,o=$('[data-form="new-password"]'),t=checkFormInputEmpty(o),n="forgot-password-2";if(!1===t)showDialer("Bitte fülle alle Felder aus!");else{var i=o.serialize()+"&action="+n;addOverlay(e);var r=e.find("page-overlay");r.find("close-overlay").remove();addLoader(r,"floating");var s=r.find("loader").parent(),l=["","0","1","5","2","3","4"];let t=dynamicHost+"/ajax/functions/sign/forgot-password";$.ajax({url:t,data:i,method:"POST",type:"TEXT",success:function(e){switch(console.log($.parseJSON(e)),s.remove(),$.inArray(e,l)?(r.removeAttr("style"),setTimeout(function(){r.remove()},400)):(addTextDialogue(r,"Passwort geändert!"),setTimeout(function(){window.location.replace("/")},1200)),e){case"":case"0":case"5":a="Ein unbekannter Fehler ist aufgetreten.";break;case"1":a="Du hast dein Passwort über diesen Key bereits geändert";break;case"2":a="Deine eingegebenen Passwörter stimmen nicht überein";break;case"3":a="Dein Passwort sollte sicherheitshalber min. 8 Zeichen enthalten";break;case"4":a="Dein Passwort enthält unzulässige Zeichen. Erlaubt sind a-z, A-Z, 0-9, =.,_-+*#~?!&%$§!";break;default:a="Erfolgreich geändert!",setTimeout(function(){window.location.replace("/")},600)}showDialer(a)}})}}).on("click",'[data-action="signout"]',function(){let a,o="logout",t=dynamicHost+"/ajax/functions/sign/out";addOverlay(e);let n=e.find("page-overlay");addLoader(n,"floating");let i=n.find("loader").parent();$.ajax({url:t,data:{action:o},method:"POST",type:"TEXT",success:function(e){i.remove(),"0"===e?(a="Erfolgreich ausgeloggt!",addTextDialogue(n,"Ausgeloggt"),setTimeout(function(){window.location.replace("/")},600)):(a="Ein unbekannter Fehler ist aufgetreten!",n.removeAttr("style"),setTimeout(function(){n.remove()},400)),showDialer(a)}})})});