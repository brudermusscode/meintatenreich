$(function(){let e=$("body"),t=$("body");$(document).on("click",'[data-action="change-product-image"] li',function(){let e,a,n;e=$(this),a=e.data("json")[0].url,n=t.find('[data-react="productview:gallery,change"]'),e.parent().find("li").removeClass("selected"),e.addClass("selected"),n.find("img").remove(),n.data("url",a).append('<img src="'+a+'" class="tran-all almid-h">'),setTimeout(function(){fadeImages(n.find("img"))},200)}).on("click",'[data-action="open-image-viewer"]',function(){let t;t=$(this).data("url"),addOverlay(e,dark=!0);let a=e.find("page-overlay");addLoader(a,"floating");let n=a.find("loader").parent();$.ajax({url:dynamicHost+"/ajax/content/productview/resize-image",data:{url:t},method:"POST",type:"HTML",success:function(e){n.remove(),a.append(e),a.find("image-viewer img").css({visibility:"visible",opacity:"1"})}})}).on("click",'[data-action="open-desc"]',function(){let t=$(this).data("json")[0].id,a=dynamicHost+"/ajax/content/productview/description",n="open-desc";addOverlay(e);let o=e.find("page-overlay");addLoader(o,"floating");let i=$("loader").parent();$.ajax({url:a,data:{action:n,id:t},method:"POST",type:"HTML",success:function(e){i.remove(),o.append(e)}})}).on("click",'[data-action="add-scard"]',function(){let e,t,a,n,o,i;e=$(this),t=e.data("json")[0].id,a="add-scard",o=dynamicHost+"/ajax/functions/productview/add-shoppingcard",i=$('[data-react="add-scard"] p'),e.attr("disabled","disabled"),e.removeAttr("data-action"),$.ajax({data:{action:a,id:t},url:o,method:"POST",type:"JSON",success:function(t){let a,o,r;a=t.status,code=t.code,o=t.message,r=t.shoppingCardAmount,a&&(i.html(r+1),n="Produkt wurde für 6 Stunden reserviert.",e.find("p:nth-of-type(2)").html("Im Warenkorb"),e.find("p:first-of-type i").attr("class","icon-ok")),showDialer(o)},error:function(e){console.log(e)}})}).on("click",'[data-action="add-scard-remember"]',function(){let e,t=$(this),a=t.parent().data("json")[0].id,n="add-scard-remember",o=dynamicHost+"/ajax/functions/productview/add-favorite";showDialer("Speichere..."),$.ajax({url:o,data:{action:n,id:a},method:"POST",type:"TEXT",success:function(a){switch(a){case"0":e="Bitte logge Dich ein, um forzufahren!";break;case"1":e="Produkt gemerkt!",t.toggleClass("white brown"),t.find("p:nth-of-type(2)").html("Gemerkt"),t.find("p:first-of-type i").attr("class","icon-star");break;case"2":t.toggleClass("white brown"),e="Produkt von der Merkliste entfernt!",t.find("p:nth-of-type(2)").html("Merken"),t.find("p:first-of-type i").attr("class","icon-star-empty");break;default:e="Ein unbekannter Fehler ist aufgetreten."}showDialer(e)}})}).on("click",'[data-action="add-rating"]',function(){let a,n,o;n=$(this).data("json")[0].id,o=dynamicHost+"/ajax/content/productview/rate",$.ajax({data:{id:n},url:o,method:"POST",type:"HTML",success:function(n){"3"==n?error="Produkte können erst nach Kauf bewertet werden":"2"==n?error="Das Produkt scheint nicht mehr zu existieren":"1"==n?error="Bitte logge dich ein, um Bewertungen abzugeben":(addOverlay(t),a=e.find("page-overlay"),a.append(n)),"1"!=n&&"2"===n&&"1"===n||showDialer(error)},error:function(e){console.error(e)}})}).on("keyup",'[data-action="po-comment"]',function(){let e=$.trim($(this).val().length),t=$(this).closest("form").find("button");console.log(t),e>=3?t.addClass("active"):t.removeClass("active")}).on("submit",'[data-form="productview:rating"]',function(e){let a,n,o,i,r,d,s,c,l;if(e.preventDefault(),a=$(this),n=a.closest(".textarea").find("textarea"),o=$.trim(n.val().length),r=new FormData(this),i=a.find('input[name="rate"]').val(),d=$("page-overlay"),s=t.find('[data-react="productview:ratings,add"]'),l=d.find("wide-container"),c=$('[data-action="add-rating"]'),url=dynamicHost+"/ajax/functions/productview/rate",o<3)showDialer("Bitte gib eine Bewertung ein");else if($.trim(i).length<1&&!$.isNumeric(i))showDialer("Wähle zwischen 1 und 5 Sternen");else{let e,t,a;addOverlay(l,dark=!0),e=l.find("page-overlay"),t=e.find("close-overlay").remove(),addLoader(e,"floating"),a=e.find("loader").parent(),$.ajax({url:url,data:r,method:"POST",type:"JSON",contentType:!1,processData:!1,success:function(e){console.log(e),url=dynamicHost+"/ajax/content/elements/rate",e.status&&$.ajax({data:{comment:n.val(),rate:i},url:url,method:"POST",type:"HTML",success:function(e){0!==e&&s.append(e),d.removeAttr("style"),setTimeout(function(){d.remove()},400)}}),showDialer(e.message)},error:function(e){console.error(e)}})}}).on("click",'[data-action="productview:ratings,vote"] .button',function(){let e,t,a,n,o,i;e=$(this),t=e.closest(".action-outer"),n=e.data("json")[0].vote,o=e.parent().data("json")[0].rid,i=e.parent().data("json")[0].pid,a=dynamicHost+"/ajax/functions/productview/rate-vote",e.parent().hasClass("unvoted")&&$.ajax({url:a,data:{vote:n,rid:o,pid:i},method:"POST",type:"JSON",success:function(a){a.status&&(t.addClass("voted").removeClass("unvoted"),"1"==n&&e.find("p:nth-of-type(2)").html(a.voteCount)),showDialer(a.message)},error:function(e){console.error(e.responseText)}})})});