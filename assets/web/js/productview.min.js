$(function(){let e=$("body"),t=$("body");$(document).on("click",'[data-action="change-product-image"] li',function(){let e,a,n;e=$(this),a=e.data("json")[0].url,n=t.find('[data-react="productview:gallery,change"]'),e.parent().find("li").removeClass("selected"),e.addClass("selected"),n.find("img").remove(),n.data("url",a).append('<img src="'+a+'" class="tran-all almid-h">'),setTimeout(function(){fadeImages(n.find("img"))},200)}).on("click",'[data-action="open-image-viewer"]',function(){let t;t=$(this).data("url"),addOverlay(e,dark=!0);let a=e.find("page-overlay");addLoader(a,"floating");let n=a.find("loader").parent();$.ajax({url:dynamicHost+"/ajax/content/productview/resize-image",data:{url:t},method:"POST",type:"HTML",success:function(e){n.remove(),a.append(e),a.find("image-viewer img").css({visibility:"visible",opacity:"1"})}})}).on("click",'[data-action="open-desc"]',function(){let t=$(this).data("json")[0].id,a=dynamicHost+"/ajax/content/productview/description",n="open-desc";addOverlay(e);let i=e.find("page-overlay");addLoader(i,"floating");let o=$("loader").parent();$.ajax({url:a,data:{action:n,id:t},method:"POST",type:"HTML",success:function(e){o.remove(),i.append(e)}})}).on("click",'[data-action="add-scard"]',function(){let e,t,a,n,i,o;e=$(this),t=e.data("json")[0].id,a="add-scard",i=dynamicHost+"/ajax/functions/productview/add-shoppingcard",o=$('[data-react="add-scard"] p'),e.attr("disabled","disabled"),e.removeAttr("data-action"),$.ajax({data:{action:a,id:t},url:i,method:"POST",type:"JSON",success:function(t){let a,i,d;a=t.status,code=t.code,i=t.message,d=t.shoppingCardAmount,a&&(o.html(d+1),n="Produkt wurde für 6 Stunden reserviert.",e.find("p:nth-of-type(2)").html("Im Warenkorb"),e.find("p:first-of-type i").attr("class","icon-ok")),showDialer(i)},error:function(e){console.log(e)}})}).on("click",'[data-action="add-scard-remember"]',function(){let e,t=$(this),a=t.parent().data("json")[0].id,n="add-scard-remember",i=dynamicHost+"/ajax/functions/productview/add-favorite";showDialer("Speichere..."),$.ajax({url:i,data:{action:n,id:a},method:"POST",type:"TEXT",success:function(a){switch(a){case"0":e="Bitte logge Dich ein, um forzufahren!";break;case"1":e="Produkt gemerkt!",t.toggleClass("white brown"),t.find("p:nth-of-type(2)").html("Gemerkt"),t.find("p:first-of-type i").attr("class","icon-star-filled");break;case"2":t.toggleClass("white brown"),e="Produkt von der Merkliste entfernt!",t.find("p:nth-of-type(2)").html("Merken"),t.find("p:first-of-type i").attr("class","icon-star-empty");break;default:e="Ein unbekannter Fehler ist aufgetreten."}showDialer(e)}})}).on("click",'[data-action="add-rating"]',function(){let a,n,i,o,d;addOverlay(t),a=e.find("page-overlay"),addLoader(a,"floating"),n=$("loader").parent(),i="add-rating",o=$(this).data("json")[0].id,d=dynamicHost+"/ajax/content/productview/rate",$.ajax({data:{action:i,id:o},url:d,method:"POST",type:"HTML",success:function(e){0!==e&&(n.remove(),a.append(e))}})}).on("keyup",'[data-action="po-comment"]',function(){let e=$.trim($(this).val().length),t=$(this).closest("form").find('button[type="submit"]');e>=3?t.addClass("active"):t.removeClass("active")}).on("submit",'[data-form="productview:rating"]',function(e){let a,n,i,o,d,r,s,c,l;if(e.preventDefault(),a=$(this),n=a.closest(".textarea").find("textarea"),i=$.trim(n.val().length),d=new FormData(this),o=a.find('input[name="rate"]').val(),r=$("page-overlay"),s=t.find('[data-react="productview:ratings,add"]'),l=r.find("wide-container"),c=$('[data-action="add-rating"]'),url=dynamicHost+"/ajax/functions/productview/rate",i<3)showDialer("Bitte gib eine Bewertung ein");else if($.trim(o).length<1&&!$.isNumeric(o))showDialer("Wähle zwischen 1 und 5 Sternen");else{let e,t,a;addOverlay(l,dark=!0),e=l.find("page-overlay"),t=e.find("close-overlay").remove(),addLoader(e,"floating"),a=e.find("loader").parent(),$.ajax({url:url,data:d,method:"POST",type:"JSON",contentType:!1,processData:!1,success:function(e){console.log(e),url=dynamicHost+"/ajax/content/elements/rate",e.status&&$.ajax({data:{comment:n.val(),rate:o},url:url,method:"POST",type:"HTML",success:function(e){0!==e&&s.append(e),r.removeAttr("style"),setTimeout(function(){r.remove()},400)}}),showDialer(e.message)},error:function(e){console.error(e)}})}}).on("click",'[data-action="comment-vote"] .button',function(){let e,t=$(this),a=t.data("json")[0].vote,n=t.parent().data("json")[0].cid,i=t.parent().data("json")[0].pid,o=t.parent().data("json")[0].uid,d="comment-vote",r=parseInt(t.parent().find(".up p:nth-of-type(2)").text());$.ajax({data:{action:d,vote:a,cid:n,pid:i,uid:o},url:"/ajax/commentvote",method:"POST",type:"TEXT",success:function(a){switch(a){case"":e="Bitte logge Dich ein, um fortzufahren.";break;case"0":e="Ein unbekannter Fehler ist aufgetreten.";break;case"1":e="Der Kommentar existiert nicht!";break;case"up":t.parent().find(".up").hasClass("white")||t.parent().find(".up p:nth-of-type(2)").html(r+1),t.toggleClass("blue white"),t.parent().find(".down").addClass("blue").removeClass("white"),e="Votum abgegeben!";break;case"down":t.parent().find(".up").hasClass("white")&&t.parent().find(".up p:nth-of-type(2)").html(r-1),t.toggleClass("blue white"),t.parent().find(".up").addClass("blue").removeClass("white"),e="Votum abgegeben!";break;case"inactive":t.parent().find(".up").hasClass("white")&&t.parent().find(".up p:nth-of-type(2)").html(r-1),t.parent().find(".button").addClass("blue").removeClass("white"),e="Votum entfernt!"}showDialer(e)}})})});